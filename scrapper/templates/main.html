<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>github-project-scrapper</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!--font awesome-->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css"
    integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
  <!--font awseome end-->

 
</head>
<style>
  .ms-n5 {
    margin-left: -40px;
  }

  .modal-content {
    background-color: #2c3036;

    color: white;
  }

  .modal-body {
    max-height: 700px;
    /* Adjust the height as needed */
    overflow-y: auto;
  }
  @media (min-width: 768px) {
  .text-large {
    font-size: 16px;
  }
}

</style>

<body>
  <!--NAVBAR START-->
  <nav class="navbar navbar-expand-lg bg-body-tertiary navbar bg-dark" data-bs-theme="dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Github Project Scrapper</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
          </li>
        </ul>
        <a type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal"
          data-bs-whatever="@getbootstrap"><i class="fas fa-iphone"></i> Contact Me</a>
      </div>
    </div>
  </nav>


  <!--NAVBAR END-->

  <!-- Video Modal Start -->
  <div class="modal fade" id="videoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-body">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <!-- 16:9 aspect ratio -->
          <div class="embed-responsive embed-responsive-16by9">
            <iframe class="embed-responsive-item" src="" id="video" allowscriptaccess="always"
              allow="autoplay"></iframe>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Video Modal End -->

  <!--search input-->

  <div class="container shadow min-vh-100 py-4">
    <div class="row">
      <div class="col-md-5 mx-auto">
        <div id="search-response" class="alert alert-dismissible alert-success" style="display: none;">
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          <div id="search-response-spin"></div> <i id="spinner-icon" class="fas fa-sync fa-spin"></i>
          <!-- <strong id="search-response-text"></strong> -->
        </div>
        <div class="input-group">
          <input class="form-control border-end-0 border rounded-pill" type="search" value="" id="example-search-input"
            placeholder="Enter Keyword to Search" onkeydown="handleSearch(event)" required>
          <span class="input-group-append">
            <button class="btn btn-outline-secondary bg-white border-bottom-0 border rounded-pill ms-n5" type="button"
              onclick="searchRepositories()">
              <i class="fa fa-search"></i>
            </button>
          </span>
        </div>
        <div class="d-flex justify-content-center mt-3">
          <button class="btn btn-primary" onclick="searchRepositories(1)">Search</button>
        </div>
        <br>
 <style>
          .button-container {
          position: relative;
        }

        .user-info {
          position: relative;
          top: 0;
          right: -200px; /* Adjust the value as per your layout */
          width: 200px; /* Adjust the width as per your preference */
          background-color: #f1f1f1;
          padding: 10px;
          border: 1px solid #ccc;
          border-radius: 4px;
        }
        .modal {
  display: none;
  position: fixed;
  z-index: 1;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 300px;
  max-width: 80%;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

#user-info {
  color: black !important;
}

.modal {
  display: none;
  /* ... */
}

#user-info {
  color: black;
}

.user-info-field {
  margin-bottom: 10px;
}

.user-info-field label {
  font-weight: bold;
}

.user-info-field span {
  margin-left: 5px;
}

.user-info-field img {
  width: 100px;
  height: 100px;
  border-radius: 50%;
  object-fit: cover;
}

</style>
<button onmouseover="showModal()" onmouseout="hideModal()">Hover Me</button>

<div id="modal" class="modal" onmouseout="hideModal()">
  <div class="modal-content">
    <span class="close" onclick="hideModal()">&times;</span>
    <div id="user-info"></div>
  </div>
</div>


    

        <div id="pagination-div" style="display: none;">
          <ul class="pagination pagination-lg">
            <li class="page-item disabled">
              <a class="page-link" href="#">&laquo;</a>
            </li>
            <li class="page-item active">
              <a class="page-link" href="#" onclick="searchRepositories(1)">1</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="#" onclick="searchRepositories(2)">2</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="#" onclick="searchRepositories(3)">3</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="#" onclick="searchRepositories(4)">4</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="#" onclick="searchRepositories(5)">5</a>
            </li>
            <li class="page-item">
              <a class="page-link" href="#">&raquo;</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div>
      <table class="table table-hover" id="table-body">

      </table>
    </div>
  </div>



  <!---CONTACT MODEL -->

  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Contact </h1> &nbsp;&nbsp;&nbsp;
          <div id="submitting-form-spinner" style="display: none;">Submitting form &nbsp;
            <i class="fas fa-sync fa-spin"></i>
          </div>
          <div id="response-message-box" class="" style="display: none;">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            <div id="success"></div>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form name="sendMessage" id="contactForm" novalidate="novalidate">
            <div class="mb-3">
              <input type="text" class="form-control" id="name" placeholder="Your Name" required>
            </div>
            <div class="mb-3">
              <input type="text" class="form-control" id="email" placeholder="Your Email" required>
            </div>
            <div class="mb-3">
              <input type="text" class="form-control" id="subject" placeholder="Subject" required>
            </div>
            <div class="mb-3">
              <textarea class="form-control" rows="5" id="message" placeholder="Message" required="required"
                data-validation-required-message="Please enter your message"></textarea>
            </div>
            <div class="control-group">
              <select class="form-control form-control-sm" id="role" required="required"
                data-validation-required-message="Please select your role">
                <option value="" disabled selected>Your Role</option>
                <option value="Developer">Developer</option>
                <option value="HR">HR</option>
                <option value="Student">Student</option>
                <option value="Manager">Manager</option>
                <option value="Manager">Client</option>
                <option value="Others">Others</option>
              </select>
              <p class="help-block text-danger"></p>
            </div>
        </div>
        <div class="modal-footer">

          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary" id="sendMessageButton">Send Message</button>
        </div>
        </form>
      </div>
    </div>
  </div>
  <!--CONTACT MODEL END-->


  <!--REadme show model-->
  <div id="show-readme" class="modal">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Readme</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true"></span>
          </button>
        </div>
        <div id="show-readme-body" class="modal-body">
          <!-- Modal body content -->
        </div>
        <div class="modal-footer">
          <button id="download-project" type="button" class="btn btn-primary">Download Project</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!--REadme show model end-->

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>

    function validateEmail(email) {
      // Regular expression for email validation
      var regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return regex.test(email);
    }

    function handleSearch(event) {
      if (event.key === "Enter") {
        // Prevent the default form submission behavior
        event.preventDefault();

        // Trigger the searchRepositories function
        searchRepositories();
      }
    }

    function removeChinese(htmlString) {
      // Create a regular expression to match Chinese characters
      var chineseRegex = /[^\x00-\x7F\x80-\xFF]/g;

      // Replace all Chinese characters with an empty string
      return htmlString.replace(chineseRegex, "");
    }
 
    function downloadProject(readmeLink) {
        console.log("download project");
        console.log(readmeLink);
        // https://github.com/angular/angular/blob/main/README.md
        // create a zip download link
        //https://github.com/angular/angular/archive/refs/heads/main.zip
        var downloadLink = readmeLink.replace("blob", "archive/refs/heads");
        downloadLink = downloadLink.replace("README.md", "main.zip");
        console.log(downloadLink);
        window.open(downloadLink, "_blank");
        
    }
 </script>
<script>
  var modalTimeout;

function showModal() {
  clearTimeout(modalTimeout);

  var modal = document.getElementById("modal");
  modal.style.display = "block";

  showUserInfo();
}

function hideModal() {
  modalTimeout = setTimeout(function() {
    var modal = document.getElementById("modal");
    modal.style.display = "none";
  }, 500);
}

function showUserInfo() {
  var userInfo = {
    'photo': "https://avatars.githubusercontent.com/u/96824004?v=4",
    'username': "Suraj1089",
    'name': "Suraj Pisal",
    'location': "Pune",
    'public_repos': 4,
    'followers': 3,
    'following': 14,
    'blog': "https://surajpisal.onrender.com",
    'twitter': "Suraj34",
    'company': "student"
  };

  var userInfoElement = document.getElementById("user-info");
  var infoString = "";

  if (userInfo.photo) {
    infoString += '<div class="user-info-field"><label></label><img src="' + userInfo.photo + '" alt="User Photo"></div>';
  }

  for (var key in userInfo) {
    if (userInfo.hasOwnProperty(key) && key !== 'photo') {
      if (userInfo[key]) {
        var label = key.charAt(0).toUpperCase() + key.slice(1); // Capitalize the label
        var value = userInfo[key];
        infoString += '<div class="user-info-field"><label>' + label + ':</label><span>' + value + '</span></div>';
      }
    }
  }

  if (infoString === "") {
    infoString = "No user information available.";
  }

  userInfoElement.innerHTML = infoString;
}

</script>
  <!--contact form -->
  <script>
    $(document).ready(function () {
      $('#contactForm').submit(function (event) {
        event.preventDefault();

        $("#submitting-form-spinner").show();

        var name = $('#name').val();
        var email = $('#email').val();
        var subject = $('#subject').val();
        var message = $('#message').val();
        var role = $('#role').val();


        // Perform field validation
        if (name === '' || email === '' || subject === '' || message === '' || role === '') {
          // Display error message if any field is empty
          $("#submitting-form-spinner").hide();
          $("#response-message-box").show();
          $("#response-message-box").addClass("alert alert-dismissible alert-danger");

          $('#success').text('All fields are required.');
          $('#success').removeClass('success-message');
          $('#success').addClass('error-message'); // Apply error class to the success message element
          return;
        }
        if (!validateEmail(email)) {
          $("#submitting-form-spinner").hide();
          $("#response-message-box").show();
          $("#response-message-box").addClass("alert alert-dismissible alert-danger");

          $('#success').text('Enter a valid email address!');
          $('#success').removeClass('success-message');
          $('#success').addClass('error-message'); // Apply error class to the success message element
          return;
        }
        var base_url = '{{ base_url }}';  // Add this line

        // Make an AJAX POST request to the backend endpoint
        $.ajax({
          type: 'POST',
          url: base_url + 'message',
          data: {
            name: name,
            email: email,
            subject: subject,
            role: role,
            message_body: message
          },
          dataType: "json",
          success: function (response) {
            // Display success message
            $("#submitting-form-spinner").hide();
            $("#response-message-box").show();
            $("#response-message-box").removeClass("alert alert-dismissible alert-danger");

            $("#response-message-box").addClass("alert alert-dismissible alert-success");

            $('#success').text('Message sent!');
            $('#success').removeClass('error-message');
            $('#success').addClass('success-message'); // Apply success class to the success message element
          },
          error: function (error) {
            // Display error message
            $("#submitting-form-spinner").hide();
            $("#response-message-box").show();
            $("#response-message-box").addClass("alert alert-dismissible alert-danger");

            $('#success').text('Error sending message.Retry! Or Send Your message at:surajpisal113@gmail.com');
            $('#success').removeClass('success-message');
            $('#success').addClass('error-message'); // Apply error class to the success message element
          }
        });
      });
    });
  </script>
  <!--contact form end-->

  <script>
    function searchRepositories(pageNumber) {
      // if table is already filled with data, empty it
      // remove all the rows
      $("#search-response").show();
      // $("#table-body").empty();
      $("#table-body").empty();


      // Get the input value
      const searchKeyword = $("#example-search-input").val();
      $("#search-response-spin").text("Generating result for " + searchKeyword);
      if (pageNumber == null) {
        pageNumber = 1;
      }

      var base_url = '{{ base_url }}';
      // Send an AJAX request to the backend with the search keyword
      $.ajax({
        type: "POST",
        url: base_url + 'scrap',
        dataType: "html",
        data: { keyword: searchKeyword, pageNumber: pageNumber },
        success: function (response) {
          // Handle the response from the backend
          // console.log(response);
          // response is html string
          // pagination-div is hidden by default in the HTML show it

          // search-response-spin hides the spinner
          if (1 == !animateRows(response, searchKeyword)) {
            $("#pagination-div").show();
            $("#table-body").empty();
            animateRows(response, searchKeyword);
            $("#search-response").hide();

          } else {
            $("#pagination-div").hide();
            $("#search-response-spin").text("No records found for query.");
            $("#spinner-icon").hide();
          }
        },
        error: function (error) {
          // search-response-spin hides the spinner
          // Display error message
          // search-response-text adds the error message
          $("#spinner-icon").hide();
          // $("#search-response-spin").removeClass("alert alert-dismissible alert-success");
          $("#search-response-spin").text("Error fetching data. Please try again later.");
          // show search response

          console.error("Error:", error);
        }
      });
    }

    function animateRows(htmlString, searchKeyword) {
      // Create a temporary container to hold the HTML content
      htmlString = removeChinese(htmlString);
      var tempContainer = document.createElement('div');
      // Get the rows from the temporary container
      tempContainer.innerHTML = htmlString;
      var rows = tempContainer.querySelectorAll('tr');
      // if length of rows == 1 then display message = 0 records found for given query searchKeyword
      if (rows.length === 1) {
        return 1;
      }



      // Access the table body
      var tableBody = document.querySelector('#table-body');

      // Iterate over the rows and add them one by one with animation
      var rowIndex = 0;
      function addRowWithAnimation() {
        if (rowIndex < rows.length) {
          var row = rows[rowIndex].cloneNode(true);

          // get 7th element in row not last

          // if textContent ==! repo_url then created a anchor tag and add textContent to its href attribute
          if (row.childNodes[6].textContent !== 'Url') {
            var repo_url = row.childNodes[6].textContent;
            var a = document.createElement('a');
            a.setAttribute('href', repo_url);
            a.setAttribute('target', '_blank');
            a.textContent = repo_url;
            row.childNodes[6].textContent = '';
            row.childNodes[6].appendChild(a);
          }


          // select last in row
          var last = row.lastElementChild;
          // if last is a tag create a button and add a tag to it
          if (last.tagName == 'TD') {
            // Print tag content
            var readmeLink = last.textContent;
            // Create the div structure
            var buttonDiv = document.createElement('div');
            buttonDiv.setAttribute('class', 'btn-group');
            buttonDiv.setAttribute('role', 'group');
            buttonDiv.setAttribute('aria-label', 'Button group');

            // Create the button
            var button = document.createElement('button');
            button.setAttribute('type', 'button');
            button.setAttribute('class', 'btn btn-success');
            button.textContent = 'Readme';

            // Append the button to the button div
            buttonDiv.appendChild(button);

            // Replace the content of the last element with the button div
            last.textContent = '';
            last.appendChild(buttonDiv);
            row.lastElementChild = last;

            // Add event listener to the button
            button.addEventListener('click', function () {
              var base_url = '{{ base_url }}';
              // Get the readme content
              $.ajax({
                url: base_url + 'readme',
                type: 'POST',
                dataType: "html",
                data: {
                  'url': readmeLink
                },
                success: function (response) {
                  // Display the readme content in a modal
                  $('#show-readme').modal('show');
                  // instead of adding directly text content render it as html
                  $('#show-readme-body').html(response);
                  //  <button id="download-project" type="button" class="btn btn-primary" onclick="downloadProject()">Download Project</button>
                  // get the download button and add event listener to it
                  // on click of download button download the project as zip
                  $("#download-project").click(function () {
                    downloadProject(readmeLink);
                  });


                },
                error: function (error) {
                  console.error("Error:", error);
                }
              });
            });
          }


          tableBody.appendChild(row);
          rowIndex++;

          // Apply animation to the row
          $(row).hide().fadeIn(500, function () {
            // Recursive call to add the next row after animation
            addRowWithAnimation();
          });
        }
      }

      // Start adding rows with animation
      addRowWithAnimation();
    }

    // Call the searchRepositories function when the Search button is clicked
    $('#search-button').click(function () {
      // get element by id=search-response and show it
      $("#search-response").show();
      $("#table-body").empty();
      searchRepositories(readmeLink);
    });


  </script>


  <!--serach input end-->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"></script>
</body>

</html>